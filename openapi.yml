openapi: "3.0.0"
info:
  version: 0.1.0
  title: Petstore Service
  license:
    name: MIT
servers:
  - url: https://api.36node.com{basePath}
    description: The production API server
    variables:
      basePath:
        default: /petstore/v0
paths:
  /alerts:
    get:
      summary: List all alerts
      operationId: listAlerts
      tags:
        - alert
      parameters:
        - name: _limit
          in: query
          description: How many items to return at one time
          required: false
          schema:
            type: integer
            format: int32
        - name: _offset
          in: query
          description: How many items to escape
          required: false
          schema:
            type: integer
            format: int32
            default: 0
        - name: _sort
          in: query
          description: Fields to sort
          required: false
          schema:
            type: string
        - name: _select
          in: query
          description: Specifies which document fields to include or exclude
          required: false
          schema:
            type: integer
        - name: type
          in: query
          description: 根据报警类型查询报警
          required: false
          schema:
            type: string
        - name: code
          in: query
          description: 根据故障码查询报警
          required: false
          schema:
            type: string
        - name: line
          in: query
          description: 根据线路查询报警
          required: false
          schema:
            type: string
        - name: plate
          in: query
          description: 根据车牌号码查询报警
          required: false
          schema:
            type: string
        - name: vehicleModel
          in: query
          description: 根据车型查询报警
          required: false
          schema:
            type: string
        - name: vehicleModelBrief
          in: query
          description: 根据车型简称查询报警
          required: false
          schema:
            type: string
        - name: vehicleNo_like
          in: query
          description: 车辆自编号模糊查询
          required: false
          schema:
            type: string
        - name: level
          in: query
          description: 根据等级查询报警
          required: false
          schema:
            type: integer
            format: int32
        - name: startedAt_gt
          in: query
          description: 按大于警报开始时间查询 格式ISOString 或者 时间戳（秒）
          required: false
          schema:
            type: string
        - name: startedAt_lt
          in: query
          description: 按小于警报开始时间查询 格式ISOString 或者 时间戳（秒）
          required: false
          schema:
            type: string
        - name: lastAt_gt
          in: query
          description: 按大于最后警报时间查询 格式ISOString 或者 时间戳（秒）
          required: false
          schema:
            type: string
        - name: lastAt_lt
          in: query
          description: 按小于最后警报时间查询 格式ISOString 或者 时间戳（秒）
          required: false
          schema:
            type: string
        - name: state
          in: query
          description: 根据状态查询报警 ['OPEN', 'CLOSED'] 开启 关闭
          required: false
          schema:
            type: string
        - name: name_like
          in: query
          description: 故障名称模糊查询
          required: false
          schema:
            type: string
        - name: ns_like
          in: query
          required: false
          description: 根据车辆namespace查询
          schema:
            type: string
        - name: vehicleYearsFromPlate_gt
          description: 报废年限大于
          in: query
          required: false
          schema:
            type: number
        - name: vehicleYearsFromPlate_lt
          description: 报废年限小于
          in: query
          required: false
          schema:
            type: number
        - name: vehicleMileage_gt
          in: query
          description: 车辆历程大于
          required: false
          schema:
            type: number
        - name: vehicleMileage_lt
          in: query
          description: 车辆历程小于
          required: false
          schema:
            type: number
        - name: id
          in: query
          description: id 列表
          required: false
          schema:
            type: array
            items:
              type: string
      responses:
        "200":
          description: A paged array of alerts
          headers:
            X-Total-Count:
              description: Total count of all alerts match the query
              schema:
                type: string
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/Alert"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "500":
          $ref: "#/components/responses/InternalError"

    post:
      summary: Create an alert
      operationId: createAlert
      tags:
        - alert
      requestBody:
        description: Alert to be created
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Alert"
      responses:
        "201":
          description: The Alert created
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Alert"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "500":
          $ref: "#/components/responses/InternalError"

  /alerts/{alertId}:
    get:
      summary: Get alert by id
      operationId: getAlert
      tags:
        - alert
      parameters:
        - name: alertId
          in: path
          required: true
          description: The id of alert
          schema:
            type: string
      responses:
        "200":
          description: The alert with given id
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Alert"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalError"

    patch:
      summary: Update alert
      operationId: updateAlert
      tags:
        - alert
      parameters:
        - name: alertId
          in: path
          required: true
          description: The id of alert
          schema:
            type: string
      requestBody:
        description: Alert to be updated
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/AlertUpdateBody"
      responses:
        "200":
          description: The alert
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Alert"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalError"

    delete:
      summary: 删除指定报警
      operationId: deleteAlert
      tags:
        - alert
      parameters:
        - name: alertId
          in: path
          required: true
          description: The id of alert
          schema:
            type: string
      responses:
        "204":
          description: alert deleted
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalError"

  /faults:
    get:
      summary: 返回故障编码列表
      operationId: listFaults
      tags:
        - fault
      responses:
        "200":
          description: A paged array of faults
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/Fault"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "500":
          $ref: "#/components/responses/InternalError"

  /warnings:
    get:
      summary: List all warnings
      operationId: listWarnings
      tags:
        - warning
      parameters:
        - name: _limit
          in: query
          description: How many items to return at one time
          required: false
          schema:
            type: integer
            format: int32
        - name: _offset
          in: query
          description: How many items to jump
          required: false
          schema:
            type: string
        - name: _select
          in: query
          description: Specifies which document fields to include or exclude
          required: false
          schema:
            type: integer
        - name: _sort
          in: query
          description: Specifies which document fields to sort
          required: false
          schema:
            type: string
        - name: type
          in: query
          description: 根据预警类型查询
          required: false
          schema:
            type: string
        - name: name_like
          in: query
          description: 根据预警名称查询
          required: false
          schema:
            type: string
        - name: lastAt_gt
          in: query
          description: 按大于预警发生时间查询 格式ISOString 或者 时间戳（秒）
          required: false
          schema:
            type: string
        - name: lastAt_lt
          in: query
          description: 按小于预警发生时间查询 格式ISOString 或者 时间戳（秒）
          required: false
          schema:
            type: string
        - name: startAt_gt
          in: query
          description: 按大于预警开始时间查询 格式ISOString 或者 时间戳（秒）
          required: false
          schema:
            type: string
        - name: startAt_lt
          in: query
          description: 按小于预警开始发生时间查询 格式ISOString 或者 时间戳（秒）
          required: false
          schema:
            type: string
        - name: line
          in: query
          description: 根据线路查询预警
          required: false
          schema:
            type: string
        - name: plate
          in: query
          description: 根据车牌号码查询预警
          required: false
          schema:
            type: string
        - name: vehicle
          in: query
          description: 根据车辆车架号查询预警
          required: false
          schema:
            type: string
        - name: vehicleModel_like
          in: query
          description: 根据车型查询预警
          required: false
          schema:
            type: string
        - name: vehicleModelBrief_like
          in: query
          description: 根据车型简称查询预警
          required: false
          schema:
            type: string
        - name: vehicleNo_like
          in: query
          description: 根据车辆自编号查询预警
          required: false
          schema:
            type: string
        - name: vehicleProducer
          in: query
          description: 根据车型生产商查询
          required: false
          schema:
            type: string
        - name: vehicleMileage_gt
          in: query
          description: 车辆历程大于
          required: false
          schema:
            type: number
        - name: vehicleMileage_lt
          in: query
          description: 车辆历程小于
          required: false
          schema:
            type: number
        - name: vehicleYearsFromPlate_gt
          in: query
          description: 报废年限大于
          required: false
          schema:
            type: number
        - name: vehicleYearsFromPlate_lt
          in: query
          description: 报废年限小于
          required: false
          schema:
            type: number
      responses:
        "200":
          description: A paged array of warnings
          headers:
            X-Total-Count:
              description: Total count of all warnings match the query
              schema:
                type: string
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/Warning"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "500":
          $ref: "#/components/responses/InternalError"

  /statistics/alert:
    get:
      summary: Get statistics of alert
      operationId: getAlertStats
      tags:
        - statistics
      parameters:
        - name: _limit
          in: query
          description: How many items to return at one time
          required: false
          schema:
            type: integer
            format: int32
        - name: _offset
          in: query
          description: How many items to escape
          required: false
          schema:
            type: integer
            format: int32
            default: 0
        - name: _sort
          in: query
          description: Fields to sort
          required: false
          schema:
            type: string
        - name: _group
          in: query
          description: Specifies which document fields to include or exclude
          required: false
          schema:
            type: string
        - name: type
          in: query
          description: 根据报警类型查询报警
          required: false
          schema:
            type: string
        - name: code
          in: query
          description: 根据故障码查询报警
          required: false
          schema:
            type: string
        - name: line
          in: query
          description: 根据线路查询报警
          required: false
          schema:
            type: string
        - name: plate
          in: query
          description: 根据车牌号码查询报警
          required: false
          schema:
            type: string
        - name: vehicle
          in: query
          description: 根据车辆车架号查询预警
          required: false
          schema:
            type: string
        - name: vehicleModel
          in: query
          description: 根据车型查询报警
          required: false
          schema:
            type: string
        - name: vehicleModelBrief
          in: query
          description: 根据车型简称查询报警
          required: false
          schema:
            type: string
        - name: vehicleNo_like
          in: query
          description: 车辆自编号模糊查询
          required: false
          schema:
            type: string
        - name: level
          in: query
          description: 根据等级查询报警
          required: false
          schema:
            type: integer
            format: int32
        - name: startedAt_gt
          in: query
          description: 按大于警报开始时间查询 格式ISOString 或者 时间戳（秒）
          required: false
          schema:
            type: string
        - name: startedAt_lt
          in: query
          description: 按小于警报开始时间查询 格式ISOString 或者 时间戳（秒）
          required: false
          schema:
            type: string
        - name: lastAt_gt
          in: query
          description: 按大于最后警报时间查询 格式ISOString 或者 时间戳（秒）
          required: false
          schema:
            type: string
        - name: lastAt_lt
          in: query
          description: 按小于最后警报时间查询 格式ISOString 或者 时间戳（秒）
          required: false
          schema:
            type: string
        - name: state
          in: query
          description: 根据状态查询报警 ['OPEN', 'CLOSED'] 开启 关闭
          required: false
          schema:
            type: string
        - name: name_like
          in: query
          description: 故障名称模糊查询
          required: false
          schema:
            type: string
        - name: ns_like
          in: query
          required: false
          description: 根据车辆namespace查询
          schema:
            type: string
        - name: vehicleYearsFromPlate_gt
          description: 报废年限大于
          in: query
          required: false
          schema:
            type: number
        - name: vehicleYearsFromPlate_lt
          description: 报废年限小于
          in: query
          required: false
          schema:
            type: number
        - name: vehicleMileage_gt
          in: query
          description: 车辆历程大于
          required: false
          schema:
            type: number
        - name: vehicleMileage_lt
          in: query
          description: 车辆历程小于
          required: false
          schema:
            type: number
      responses:
        "200":
          description: The alert stats
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AlertStats"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalError"

  /statistics/warning:
    get:
      summary: Get statistics of warning
      operationId: getWarningStats
      tags:
        - statistics
      parameters:
        - name: _limit
          in: query
          description: How many items to return at one time
          required: false
          schema:
            type: integer
            format: int32
        - name: _offset
          in: query
          description: How many items to jump
          required: false
          schema:
            type: string
        - name: _group
          in: query
          description: Specifies which document fields to include or exclude
          required: false
          schema:
            type: string
        - name: _sort
          in: query
          description: Specifies which document fields to sort
          required: false
          schema:
            type: string
        - name: type
          in: query
          description: 根据预警类型查询
          required: false
          schema:
            type: string
        - name: name_like
          in: query
          description: 根据预警名称查询
          required: false
          schema:
            type: string
        - name: lastAt_gt
          in: query
          description: 按大于预警发生时间查询 格式ISOString 或者 时间戳（秒）
          required: false
          schema:
            type: string
        - name: lastAt_lt
          in: query
          description: 按小于预警发生时间查询 格式ISOString 或者 时间戳（秒）
          required: false
          schema:
            type: string
        - name: line
          in: query
          description: 根据线路查询预警
          required: false
          schema:
            type: string
        - name: plate
          in: query
          description: 根据车牌号码查询预警
          required: false
          schema:
            type: string
        - name: vehicle
          in: query
          description: 根据车辆车架号查询预警
          required: false
          schema:
            type: string
        - name: vehicleModel
          in: query
          description: 根据车型查询预警
          required: false
          schema:
            type: string
        - name: vehicleModelBrief
          in: query
          description: 根据车型简称查询预警
          required: false
          schema:
            type: string
        - name: vehicleNo
          in: query
          description: 根据车辆自编号查询预警
          required: false
          schema:
            type: string
        - name: vehicleProducer
          in: query
          description: 根据车型生产商查询
          required: false
          schema:
            type: string
        - name: vehicleMileage_gt
          in: query
          description: 车辆历程大于
          required: false
          schema:
            type: number
        - name: vehicleMileage_lt
          in: query
          description: 车辆历程小于
          required: false
          schema:
            type: number
        - name: vehicleYearsFromPlate_gt
          in: query
          description: 报废年限大于
          required: false
          schema:
            type: number
        - name: vehicleYearsFromPlate_lt
          in: query
          description: 报废年限小于
          required: false
          schema:
            type: number
      responses:
        "200":
          description: The warning stats
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/WarningStats"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalError"

  /stages:
    get:
      summary: 查看所有泳道
      operationId: listStages
      tags:
        - ticket
      parameters:
        - name: _limit
          in: query
          description: How many items to return at one time
          required: false
          schema:
            type: integer
            format: int32
        - name: _offset
          in: query
          description: How many items to jump
          required: false
          schema:
            type: string
      responses:
        "200":
          description: A paged array of stages
          headers:
            X-Total-Count:
              description: Total count of all stages match the query
              schema:
                type: string
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/Stage"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "500":
          $ref: "#/components/responses/InternalError"

    post:
      summary: 创建泳道
      operationId: createStage
      tags:
        - ticket
      requestBody:
        description: stage to be created
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Stage"
      responses:
        "200":
          description: The stage created
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Stage"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "500":
          $ref: "#/components/responses/InternalError"

  /tickets:
    get:
      summary: List all tickets
      operationId: listTickets
      tags:
        - ticket
      parameters:
        - name: _limit
          in: query
          description: How many items to return at one time
          required: false
          schema:
            type: integer
            format: int32
        - name: _offset
          in: query
          description: How many items to jump
          required: false
          schema:
            type: string
        - name: _select
          in: query
          description: Specifies which document fields to include or exclude
          required: false
          schema:
            type: integer
        - name: _sort
          in: query
          description: Specifies which document fields to sort
          required: false
          schema:
            type: string
        - name: q
          in: query
          description: 根据车辆自编号/工单号/报警号/车架号查询
          required: false
          schema:
            type: string
        - name: createdAt_gt
          in: query
          description: 创建时间大于
          required: false
          schema:
            type: number
        - name: createdAt_lt
          in: query
          description: 创建时间小于
          required: false
          schema:
            type: number
        - name: updatedAt_gt
          in: query
          description: 更新时间大于
          required: false
          schema:
            type: number
        - name: updatedAt_lt
          in: query
          description: 更新时间小于
          required: false
          schema:
            type: number
        - name: vehicle
          in: query
          description: 根据车辆查询
          required: false
          schema:
            type: string
        - name: state
          in: query
          description: 根据工单状态查询
          required: false
          schema:
            type: string
      responses:
        "200":
          description: A paged array of tickets
          headers:
            X-Total-Count:
              description: Total count of all tickets match the query
              schema:
                type: string
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/Ticket"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "500":
          $ref: "#/components/responses/InternalError"

    post:
      summary: 创建工单/任务单
      operationId: creatTicket
      tags:
        - ticket
      requestBody:
        description: ticket to be created
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/TicketDoc"
      responses:
        "200":
          description: The ticket created
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Ticket"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "500":
          $ref: "#/components/responses/InternalError"

  /tickets/{ticketId}:
    get:
      summary: Get a ticket by id
      operationId: getTicket
      tags:
        - ticket
      parameters:
        - name: ticketId
          in: path
          required: true
          description: The id of ticket
          schema:
            type: string
      responses:
        "200":
          description: The ticket with given id
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Ticket"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalError"

  
  /tickets/{ticketId}/events:
    post:
      summary: 创建工单事件
      operationId: createEvent
      tags:
        - ticket
      parameters:
        - name: ticketId
          in: path
          required: true
          description: The id of ticket
          schema:
            type: string
      requestBody:
        description: event to be created
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/TicketEvent"
      responses:
        "200":
          description: The ticket event created
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/TicketEvent"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalError"


security:
  - bearerAuth: []

components:
  responses:
    NoContent:
      description: The resource was deleted successfully.
    NotFound:
      description: The specified resource was not found
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/Err"
    Unauthorized:
      description: Unauthorized
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/Err"
    InternalError:
      description: unexpected error
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/Err"
  schemas:
    AlertUpdateBody:
      type: object
      properties:
        state:
          type: string
          enum: ["OPEN", "CLOSED"]
          default: "OPEN"
          description: "状态: 开启，关闭"
        lastAt:
          type: string
          format: date
          description: "最近一次报警时间"
        count:
          type: integer
          format: int32
          description: "次数"

    Alert:
      type: object
      required:
        - id
        - startedAt
        - lastAt
        - code
        - level
        - state
        - vehicleNo
        - ns
      properties:
        # 基本字段
        id:
          type: string
        createdAt:
          type: string
          format: date
          description: "创建时间"
        updatedAt:
          type: string
          format: date
          description: "更新时间"
        deleted:
          type: boolean
          default: false
          description: "是否已经删除"
        deletedAt:
          type: string
          format: date
          description: "删除时间"
        ns:
          type: array
          description: "报警所属命名空间"
          items:
            type: string
        # 业务字段
        startedAt:
          type: string
          format: date
          description: "开始报警的时间"
        lastAt:
          type: string
          format: date
          description: "最近一次报警时间"
        code:
          type: string
          description: "故障码"
        count:
          type: integer
          format: int32
          description: "次数"
        level:
          type: integer
          format: int32
          description: "故障等级"
        line:
          type: string
          description: "线路"
        name:
          type: string
          description: "故障名称"
        plate:
          type: string
          description: "车牌号"
        state:
          type: string
          enum: ["OPEN", "CLOSED"]
          default: "OPEN"
          description: "状态: 开启，关闭"
        vehicle:
          type: string
          description: "车辆车架号"
        vehicleModel:
          type: string
          description: "车型"
        vehicleModelBrief:
          type: string
          description: "车型简称"
        vehicleNo:
          type: string
          description: "车辆自编号"
        vehicleMileage:
          type: Number
          description: "车辆总里程"
        vehilceExpiredAt:
          type: Number
          description: "车辆报废日期"
        ticket:
          type: string
          description: "工单编号"
        handleWay:
          type: string
          description: "处理方式"
        handler:
          type: string
          description: "处理人id"
        handleAt:
          type: string
          description: "处理时间"

    AlertStats:
      type: object
      properties:
        id:
          type: string
        ## dimension
        ns:
          type: array
          description: "报警所属命名空间"
          items:
            type: string
        code:
          type: string
          description: "故障码"
        level:
          type: integer
          format: int32
          description: "故障等级"
        line:
          type: string
          description: "线路"
        name:
          type: string
          description: "故障名称"
        plate:
          type: string
          description: "车牌号"
        state:
          type: string
          enum: ["OPEN", "CLOSED"]
          default: "OPEN"
          description: "状态: 开启，关闭"
        vehicle:
          type: string
          description: "车辆车架号"
        vehicleModel:
          type: string
          description: "车型"
        vehicleModelBrief:
          type: string
          description: "车型简称"
        vehicleNo:
          type: string
          description: "车辆自编号"
        vehicleMileage:
          type: Number
          description: "车辆总里程"
        vehicleYearsFromPlate:
          type: Number
          description: "车辆使用年限"
        ## metric
        count:
          type: integer
          format: int32
          description: 硬件上报次数
        times:
          type: integer
          format: int32
          description: 报警数量(时间槽规约)

    Fault:
      type: object
      description: 定义故障码
      properties:
        name:
          type: string
          description: 故障名称
        code:
          type: integer
          format: int32
          description: 故障编码
        level:
          type: integer
          format: int32
          description: 故障等级

    GeoLocation:
      type: object
      description: "位置"
      properties:
        lng:
          type: number
          format: float
          description: "经度"
        lat:
          type: number
          format: float
          description: "纬度"

    Warning:
      type: object
      required:
        - id
        - type
        - vehicle
      properties:
        # 基本字段
        id:
          type: string
        createdAt:
          type: string
          format: date
          description: "创建时间"
        updatedAt:
          type: string
          format: date
          description: "更新时间"
        deleted:
          type: boolean
          default: false
          description: "是否已经删除"
        deletedAt:
          type: string
          format: date
          description: "删除时间"
        # 业务字段
        count:
          type: integer
          format: int32
          description: "次数"
        line:
          type: string
          description: "线路"
        name:
          type: string
          description: "预警名称"
        plate:
          type: string
          description: "车牌号"
        lastAt:
          type: string
          format: date
          description: "预警最后一次的时间"
        startAt:
          type: string
          format: date
          description: "预警开始时间"
        type:
          type: string
          description: "预警类型"
        vehicle:
          type: string
          description: "车辆车架号"
        vehicleModel:
          type: string
          description: "车型"
        vehicleModelBrief:
          type: string
          description: "车型简称"
        vehicleNo:
          type: string
          description: "车辆自编号"
        vehicleProducer:
          type: string
          description: "车辆生产商"
        vehiclePlateAt:
          type: string
          format: date
          description: "车辆上牌日期"
        vehicleYearsFromPlate:
          type: number
          description: "车辆使用年限"
        vehicleMileage:
          type: number
          description: "车辆里程"
        data:
          type: object
          description: "预警数据"
        ns:
          type: array
          description: "预警所属命名空间"
          items:
            type: string

    WarningStats:
      type: object
      properties:
        id:
          type: string
        ## dimension
        ns:
          type: array
          description: "报警所属命名空间"
          items:
            type: string
        line:
          type: string
          description: "线路"
        name:
          type: string
          description: "预警名称"
        plate:
          type: string
          description: "车牌号"
        type:
          type: string
          description: "预警类型"
        vehicle:
          type: string
          description: "车辆车架号"
        vehicleModel:
          type: string
          description: "车型"
        vehicleModelBrief:
          type: string
          description: "车型简称"
        vehicleNo:
          type: string
          description: "车辆自编号"
        vehicleProducer:
          type: string
          description: "车辆生产商"
        vehicleYearsFromPlate:
          type: number
          description: "车辆使用年限"
        vehicleMileage:
          type: number
          description: "车辆里程"
        ## metric
        count:
          type: integer
          format: int32
          description: 硬件上报次数
        times:
          type: integer
          format: int32
          description: 报警数量(时间槽规约)

    Vehicle:
      type: object
      description: "车辆信息"
      properties:
        id:
          type: string
          description: 车辆vin码
        ns:
          type: string
          description: "车辆所属命名空间"
        online:
          type: boolean
          description: "车辆是否在线"
        repairing:
          type: boolean
          description: "车辆是否维修中"
        ## 车辆档案
        brands:
          type: string
          description: "品牌"
        capacity:
          type: integer
          format: int32
          description: "额定载客人数"
        num:
          type: string
          description: "车辆自编号"
        emission:
          type: string
          enum: ["C1", "C2", "C3", "C4", "C5", "C6"]
          description: "排放标准 国标1~6"
        engineNo:
          type: string
          description: "发动机编号"
        expiredAt:
          type: string
          format: date
          description: "报废日期"
        length:
          type: number
          format: float
          description: "车辆长度"
        lifeYear:
          type: integer
          format: int32
          description: "使用年限"
        line:
          type: string
          description: "线路"
        model:
          type: string
          description: "车型"
        modelBrief:
          type: string
          description: "车型简称"
        modified:
          type: boolean
          description: "是否改装"
        photos:
          type: array
          description: "车辆图片"
          items:
            type: string
        place:
          type: string
          description: "停车位置"
        plate:
          type: string
          description: "车牌"
        plateAt:
          type: string
          format: date
          description: "上牌日期"
        powerBy:
          type: string
          enum:
            [
              "FUEL",
              "HYBIRD",
              "DUAL-ENERGY",
              "PHEV",
              "E-REV",
              "ELECTRIC",
            ]
          description: "能源类型：燃油,混合动力,双源无轨,插电式混合,增程式混合,纯电动"
        producer:
          type: string
          description: "生产商"
        purchasedAt:
          type: string
          format: date
          description: "购买日期"
        remark:
          type: string
          description: "备注"
        scrapped:
          type: boolean
          description: "是否报废"
        seats:
          type: integer
          format: int32
          description: "座位数"
        type:
          type: string
          description: "客车类型，例如大型普通客车"

    Stage:
      type: object
      description: "工单阶段"
      properties:
        id:
          type: string
        createdAt:
          type: string
          format: date
          description: "创建时间"
        updatedAt:
          type: string
          format: date
          description: "更新时间"
        name:
          type: string
          description: "阶段名称"

    Ticket:
      type: object
      description: "工单/任务"
      required:
        - id
      properties:
        # 基本字段
        id:
          type: string
        createdAt:
          type: string
          format: date
          description: "创建时间"
        createdBy:
          type: string
          description: "工单创建者"
        updatedAt:
          type: string
          format: date
          description: "更新时间"
        updatedBy:
          type: string
          description: "工单更新者"
        # 关联
        alerts:
          type: array
          items:
            type: string
        reference:
          type: string
          description: "外部系统的工单id"
        stage:
          oneOf:
            - type: string
            - $ref: "#/components/schemas/Stage"
        vehicle:
          oneOf:
            - type: string
            - $ref: "#/components/schemas/Vehicle"
        vehicleNo:
          type: string
          description: "车辆自编号"
        # 业务字段
        state:
          type: string
          description: "工单状态"
          enum: ["OPEN", "CLOSED"]
        remark:
          type: string
          description: "备注"
        events:
          type: array
          items:
            $ref: "#/components/schemas/TicketEvent"

    TicketDoc:
      type: object
      description: "工单/任务"
      properties:
        createdBy:
          type: string
          description: "工单创建者"
        updatedBy:
          type: string
          description: "工单更新者"
        # 关联
        reference:
          type: string
          description: "外部系统的工单id"
        stage:
          type: string
          description: "stage id"
        vehicle:
          type: string
          description: "车辆vin码"
        vehicleNo:
          type: string
          description: "车辆自编号"
        events:
          type: array
          items:
            $ref: "#/components/schemas/TicketEvent"
        ns:
          type: string
          description: "工单所属ns"
        # 业务字段
        remark:
          type: string
          description: "备注"


    TicketEvent:
      type: object
      description: "工单/任务-事件"
      properties:
        id:
          type: string
        createdAt:
          type: string
          format: date
          description: "创建时间"
        createdBy:
          type: string
          description: "事件创建者"
        name:
          type: string
          enum: ["CLOSE", "REOPEN", "STAGE", "COMMENT", "BIND_ALERT", "CREATE"]
          description: "事件名称"
        from:
          type: string
          description: "from stage"
        to:
          type: string
          description: "to stage"
        alerts:
          type: array
          items:
            type: string
        content:
          type: string
          description: "评论内容"

    Err:
      type: object
      properties:
        code:
          type: string
        message:
          type: string
      required:
        - code
        - message

  securitySchemes:
    bearerAuth: # arbitrary name for the security scheme
      type: http
      scheme: bearer
      bearerFormat: JWT
